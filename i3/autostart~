#!/bin/sh

# Packages you need to install on Fedora in order to get this setup:
# dnf install i3lock dmenu dunst network-manager-applet workrave stardict numlockx feh \
# scrot f\*-backgrounds-base f\*-backgrounds-extras-base

# Also using:
# https://github.com/Tomas-M/xlunch

# Wait for program coming up
wait_for_program () {
 n=0
 while true
 do
   # PID of last background command
   if xdotool search --onlyvisible --pid $! 2>/dev/null; then
     break
   else
     if [ $n -eq 200 ]; then
       notify-send -u critical "Error during start: last program $! did not start fast enough"
       break
     else
       n=`expr $n + 1`
       sleep 0.1
     fi
    fi
  done
}

## Merge Xresources
xrdb -merge ~/.Xresources &

## Desktop background or picture
xsetroot -solid '#101010' &
#feh --bg-fill $(find /usr/share/backgrounds -type f -name \*jpg -o -name \*.png | shuf -n 1)

## Terminal daemon
TERMINAL=urxvt

## Load samples for volume keys feedback
#pactl upload-sample ~/.i3/that_was_easy.wav that_was_easy &
#pactl upload-sample ~/.i3/volume_blip.wav volume_blip &
#pactl upload-sample ~/.i3/mute.wav mute &
#pactl upload-sample ~/.i3/speak.wav speak &

## Disable beeps
#xset -b &

## Keybord layout setting
#setxkbmap -layout cz,us -option grp:shift_shift_toggle &

## C-A-Backspace to kill X
#setxkbmap -option terminate:ctrl_alt_bksp &

## Turns on the numlock key in X11
#numlockx on &

## DPMS monitor setting (standby -> suspend -> off) (seconds)
#xset dpms 600 1200 2000 &

## Set LCD brightness
#xbacklight -set 100 &

## Gamma correction through the X server
#xgamma -gamma 1.1 &

## Mouse and trackball setup
#~/bin/configure-input-devices >/dev/null 2>&1 &

## Configure panel from left side
PRIM_OUT=HDMI-1
SEC_OUT=HDMI-2
xrandr --output $SEC_OUT --right-of $PRIM_OUT --output $SEC_OUT --rotate right

## OSD
LC_ALL=C dunst &

## Sublime Text
#i3-msg "workspace 1; move workspace to output $PRIM_OUT"
#/opt/sublime_text/sublime_text &
#wait_for_program
## Start apps with defined workspaces

i3-msg "workspace 10"
$TERMINAL &
wait_for_program
i3-msg "split v"
$TERMINAL -e irissi&
wait_for_program


i3-msg workspace 4
/usr/bin/urxvt &
wait_for_program
/usr/bin/emacs &
wait_for_program


i3-msg workspace 5
/usr/bin/urxvt &
wait_for_program
/usr/bin/firefox &
wait_for_program


#i3-msg "workspace 1"
## Setup workspaces and terminals
#for w in 1; do
  i3-msg "workspace 1; move workspace to output $PRIM_OUT"
  $TERMINAL &
  wait_for_program
  i3-msg split h
  $TERMINAL &
  wait_for_program
  i3-msg split v
  $TERMINAL  &
  wait_for_program
  i3-msg "focus left; split v"
  i3-msg "move workspace to output $PRIM_OUT"
#done

#flatpak run com.github.quaternion/x86_64/stable &>/dev/null &
#hexchat &>/dev/null &

## Refresh
#xrefresh &

## Special keys
#sleep 4s && xmodmap /home/lzap/.Xmodmap &

## Start taskbar utils
LC_ALL=C parcellite &>/dev/null &
LC_ALL=C nm-applet &>/dev/null &
#LC_ALL=C workrave &>/dev/null &
#LC_ALL=C dropbox start &>/dev/null &

## Update launcher cache
#bash /home/lzap/work/xlunch/extra/genentries -p /home/lzap/.local/share/icons > /home/lzap/.config/xlunch/entries.dsv 2>/dev/null &
#dmenu_path >/dev/null &

## Good work :-)
exit 0
